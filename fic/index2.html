<!DOCTYPE html>
<html>
    <head>
        <title></title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <script src="fic.js"></script>
        <script src="imgLib.js"></script>
        <script src="../js/jquery.min.js"></script>
        <script src="../js/json2.js"></script>
    </head>
    <body>
        <h1>Fractal Image Compression</h1>
        
        <img id="sourceImage" src="veronika.png" onload="start()"/>
        <canvas id="canvas" width="100" height="100"></canvas>
        <br />
        <textarea id="imageData" cols="80" rows="15"></textarea>
        
        <script>
            var pass = 0;
            var dec = null;
            var img = null;
            
            function doPass() {
                dec.onePass();
                var cEl = $('#canvas').get(0);
//                var i = dec.image.clone();
//                i.scale(2);
                dec.image.paint(cEl);
                
                if (pass++ < 10) {
                    setTimeout(doPass, 1000);
                }
            }
            
            function start() {
                var imgEl = $('#sourceImage').get(0);
                var cEl = $('#canvas').get(0);
                img = imageToImage(imgEl);
                
                var enc = new Encoder(img, 6);
                var data = enc.encode();
                $("#imageData").val(JSON.stringify(data, null, 3));
                
//                img2.paint(cEl)
                var dest = img.clone(); //new Image(img.width, img.height);
//                dest.transform(3);
                var dest = new Image(img.width, img.height);
                dec = new Decoder(data, dest);
//                dec.onePass();
                dest.paint(cEl);
                setTimeout(doPass, 1000);
            }
        </script>
        
    </body>
</html>
